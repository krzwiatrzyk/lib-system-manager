version: 3

tasks:
  install-all:
  - task: install
  - task: set-as-default-shell
  - task: oh-my-zsh:install
  - task: powerlevel10k:install
  - task: autosuggestions:install
  - task: fuzzy-finder:install
  - task: syntax-highlighting:install
  - task: :dotfiles:copy:zshrc
  - task: :dotfiles:copy:p10k

  install:
    cmds:
    - sudo apt-get install zsh -y
    - touch {{ .USER_STATUS_FILES_PATH }}/{{ .TASK }}
    status:
    - test -f {{ .USER_STATUS_FILES_PATH }}/{{ .TASK }}

  set-as-default-shell:
    cmds:
    - chsh -s $(which zsh)
    - touch {{ .USER_STATUS_FILES_PATH }}/{{ .TASK }}
    status:
    - test -f {{ .USER_STATUS_FILES_PATH }}/{{ .TASK }}

  oh-my-zsh:install:
    cmds:
    - sh -c "$(wget -O- https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh) && exit 0" 
    - touch {{ .USER_STATUS_FILES_PATH }}/{{ .TASK }}
    status:
    - test -f {{ .USER_STATUS_FILES_PATH }}/{{ .TASK }}
    interactive: true

  powerlevel10k:install:
    cmds:
    - sudo apt-get install fonts-font-awesome -y 
    - git clone --depth=1 https://github.com/romkatv/powerlevel10k.git ${ZSH_CUSTOM:-$HOME/.oh-my-zsh/custom}/themes/powerlevel10k
    - touch {{ .USER_STATUS_FILES_PATH }}/{{ .TASK }}
    status:
    - test -f {{ .USER_STATUS_FILES_PATH }}/{{ .TASK }}

  autosuggestions:install:
    cmds:
    - git clone https://github.com/zsh-users/zsh-autosuggestions ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-autosuggestions
    - touch {{ .USER_STATUS_FILES_PATH }}/{{ .TASK }}
    status:
    - test -f {{ .USER_STATUS_FILES_PATH }}/{{ .TASK }}

  syntax-highlighting:install:
    cmds:
    - git clone https://github.com/zsh-users/zsh-syntax-highlighting.git ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-syntax-highlighting
    - touch {{ .USER_STATUS_FILES_PATH }}/{{ .TASK }}
    status:
    - test -f {{ .USER_STATUS_FILES_PATH }}/{{ .TASK }}

  fuzzy-finder:install:
    dir: ~/.oh-my-zsh/custom/plugins
    cmds:
    - git clone https://github.com/unixorn/fzf-zsh-plugin.git fzf-zsh-plugin

  fix-history:
    cmds:
    - |
      cd ~
      mv .zsh_history .zsh_history_bad
      strings -eS .zsh_history_bad > .zsh_history
      zsh -c "fc -R .zsh_history"